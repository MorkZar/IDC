build-job:
  stage: build
  image: composer:2
  cache:
    key: "${CI_COMMIT_REF_SLUG}-composer"
    paths:
      - vendor/
      - .composer/cache/
  script:
    - echo "Buscando composer.json..."
    - FILE=$(find . -maxdepth 3 -name composer.json | head -n 1 || true)
    - if [ -z "$FILE" ]; then echo "ERROR: No se encontr√≥ composer.json en el repo."; ls -la .; exit 1; fi
    - DIR=$(dirname "$FILE")
    - echo "composer.json encontrado en: $DIR"
    - cd "$DIR"
    - echo "Ejecutando composer install en $(pwd)..."
    - composer install --no-interaction --prefer-dist --no-progress
    - echo "Build completo."
  artifacts:
    paths:
      - vendor/
    expire_in: 1 hour



